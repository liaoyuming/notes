# 计算机系统


## 信息的表示和处理

### 数字表示

- 无符号编码

	- 表示大于或等于零的数字

- 补码编码

	- 表示有符号整数

- [浮点数编码](./float.md)

### 溢出

计算机的表示法是用有限数位的位来对一个数字编码，当结果太大以致不能表示的时候，就会导致溢出

### 字节

### 字长（word size）

- 指针数据的标称大小，决定虚拟地址空间最大大小 2^w 个字节

### 寻址

- 字节顺序

	- 小端法 （Little endian）

		- 取低字节的数据存放在低地址
		  举例：  
		  0x01234567  
		  
		  从低位到高位的存储顺序为：  
		  0x67 , 0x45 ，0x23 , 0x01

	- 大端法（Big endian）

		- 取高字节的数据存放在低地址
		  举例：  
		  0x01234567  
		  
		  从低位到高位的存储顺序为：  
		  0x01 , 0x23 , 0x45 , 0x67

- 多字节对象都被存储为连续的字节序列

- 对象的地址

### 字符串表示

- ASCII 字符码

### 布尔代数

- 运算符

	- NOT ~

	- AND &

	- OR |

	- EXCLUSIVE-OR ^

## 程序的机器级表示

### 机器级编程

机器执行的程序只是一个字节序列，它是对一系列指令的编码

- 指令集架构
  用来定义机器级程序的格式和行为，定义了处理器的状态、指令的格式，以及每条指令对状态的影响

	- 一条机器指令只执行一个非常基本的操作

- 内存
  机器级程序使用的内存地址是虚拟地址，提供的内存模型看上去是一个非常大的字节数组。

	- 程序的可执行机器代码

	- 操作系统需要的一些信息

	- 管理过程调用和返回的运行时栈

	- 用户分配的内存块

### 汇编代码

汇编代码是机器代码的文本表示，给出程序中的每一天指令

## 硬件

### 总线

### I/O 设备

### 主存

### 处理器

## 存储器层次结构

### 存储技术

- 随机访问存储器（Random-Access Memory, RAM）

	- 静态 RAM（SRAM）

		- 应用

			- 高速缓存存储器

		- 只要有供电，就能保持不变

		- 更贵，功耗更大

	- 动态 RAM（DRAM）

		- 应用

			- 主存，帧缓冲区

		- 需要刷新

		- 对光和电噪声敏感

### 局部性原理 principle of locality

- 时间局部性 temporal locality

- 空间局部性 spatial locality

### 存储器层次结构

- 寄存器

- L1 高速缓存（SRAM）

- L2 高速缓存（SRAM）

- L3 高速缓（SRAM）

- 主存（DRAM）

- 本地存储（本地磁盘）

- 远程存储 （Web 服务器）

### 高速缓存

- 结构

	- 2^s 个高速缓存组 cache set

		- E 个高速缓存行 cache line

			- 1 个有效位 valid bit

			- t 个标记位 tag bit

			- 2^b 字节数据块 block

- 地址
  高速缓存的结构将地址划分为 t 个标记位，s 个组索引，b 个块偏移位

	- 标记位

	- 组索引位

	- 块偏移位

- 分类

	- 直接映射高速缓存
	  对应多个组，每个组只有一行

	- 组相联高速缓存
	  对应多个组，每个组有多行，如果每个组都有2行，叫2路组相联高速缓存

	- 全相联高速缓存
	  对应只有一个组，这个组包含所有高速缓存行

- 写操作

	- 写命中

		- 直写 write-through

		- 回写 write-back

			- 优点

				- 减少总线流量

			- 缺点

				- 增加复杂性，维护额外的修改位

	- 写不命中

		- 写分配 write-allocate
		  加载相应的低一层缓存到高速缓存中，然后更新这个高速缓存块

			- 优点

				- 利用了写的空间局部性

			- 缺点

				- 每次不命中会导致一个块从低一层缓存传到高速缓存

		- 非写分配 not-write-allocate
		  避开高速缓存，直接把字写到低一层缓存

## 系统级 I/O

### Unix I/O

### 文件

- type

	- 普通文件 regular file

	- 目录 directory

	- 套接字 socket

## 网络编程

### 网络

- LAN（Local Area Network）局域网

	- 以太网（Ethernet）

		- 以太网段（Ethernet segment）

			- 电缆（双绞线）
			  一端连接到主机的适配器，另一端连接到集线器的一个端口上。

			- 集线器
			  集线器会将从一个端口上收到的每一位复制到其他所有的端口上。

		- 桥接以太网（bridged Ethernet）

			- 电缆

			- 网桥

			- 多个以太网段

- WAN（Wide-Area Network）广域网

## 异常控制流 （Exceptional Control Flow， ECF）

### 异常 exception

|      类别      |        原因         | 异步/同步 |       返回行为       |        举例        |
| :------------: | :-----------------: | :-------: | :------------------: | :----------------: |
| 中断 interrupt | 来自 I/O 设备的信号 |   异步    | 总是返回到下一个指令 | 网络适配器接受数据 |
|   陷阱 trap    |     有意的异常      |   同步    | 总是返回到下一条指令 |      系统调用      |
|   故障 fault   |  潜在可恢复的错误   |   同步    |  可能返回到当前指令  | 缺页异常、除法错误 |
|   终止 abort   |   不可恢复的错误    |   同步    |       不会返回       |      硬件错误      |

#### 异常号

- 处理器
  被零除、缺页、内存访问违例、断点、算术运算溢出等

- 操作系统
  系统调用、外部 I/O 设备的信号等

#### 异常表

- 异常表基址寄存器

- 异常处理程序

### 进程

- 逻辑控制流

- 私有地址空间

	- 内核虚拟内存

	- 用户栈

	- 堆

	- 未初始化数据段 （.bss）

	- 初始化数据段

	- 只读代码段

- 用户模式 和 内核模式

- 上下文切换

	- 调度 scheduling

- 进程控制

	- 获取进程 ID

	- 创建和终止进程

		- 进程图

			- 拓扑排序

### 信号

| 序号 |   名称   |              默认行为               |          事件          | 事件举例    |                             注备                             |
| :--: | :------: | :---------------------------------: | :--------------------: | ----------- | :----------------------------------------------------------: |
|  9   | SIGKILL  |              终止进程               |        杀死进程        | kill -9 PID |   该信号不能被处理程序阻止，忽略或捕获，因此总是终止进程。   |
|  2   |  SIGINT  |              终止进程               |     来自键盘的中断     | ctrl + c    | ctrl + c 会导致内核发送一个 SIGINT 信号到前台进程租中的每个进程。 |
|  3   | SIGQUIT  |              终止进程               |     来自键盘的退出     | ctrl + \    | 此信号不仅终止前台进程组（如 SIGINT 所做的那样），同时产生一个 core 文件，在这个意义上类似于一个程序错误信号。 |
|  20  | SIGTSTOP | 停止（挂起）直到被 SIGCONT 信号重启 |   来自终端的停止信号   | ctrl + z    |                                                              |
|  18  | SIGCONT  |           进程忽略此信号            | 继续进程如果该进程停止 |             |                                                              |
|  15  | SIGTERM  |              终止进程               |      软件终止信号      | kill PID    |         该信号是 kill 和 killall 命令发送的默认信号          |

## [虚拟内存](./virtual_memory.md)

---

参考资料：

- 《深入理解计算机系统》

